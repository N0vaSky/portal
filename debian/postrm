#!/bin/sh
set -e

case "$1" in
    purge)
        # Remove configuration files
        rm -rf /etc/fibratus
        
        # Remove data directory
        rm -rf /var/lib/fibratus
        
        # Remove NGINX configuration
        if [ -f /etc/nginx/sites-enabled/fibratus-portal ]; then
            rm -f /etc/nginx/sites-enabled/fibratus-portal
            systemctl reload nginx
        fi
        
        # Remove the system user
        if getent passwd fibratus > /dev/null; then
            deluser --quiet --system fibratus
        fi
        if getent group fibratus > /dev/null; then
            delgroup --quiet --system fibratus
        fi
        ;;
        
    remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
        # Remove NGINX symbolic link
        if [ -f /etc/nginx/sites-enabled/fibratus-portal ]; then
            rm -f /etc/nginx/sites-enabled/fibratus-portal
            systemctl reload nginx
        fi
        ;;
    
    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0